---
title: Python SDK configuration
sidebarTitle: Configuration
description: How to configure the Apitally SDK for Python.
mode: wide
---

## Configuration

<CodeGroup>
  ```python FastAPI {7-9}
  from fastapi import FastAPI
  from apitally.fastapi import ApitallyMiddleware

  app = FastAPI()
  app.add_middleware(
      ApitallyMiddleware,
      client_id="your-client-id",
      env="dev",
      # other parameters ...
  )
  ```

  ```python Django {2-4}
  APITALLY_MIDDLEWARE = {
      "client_id": "your-client-id",
      "env": "dev",
      # other parameters ...
  }
  ```

  ```python Flask {7-9}
  from flask import Flask
  from apitally.flask import ApitallyMiddleware

  app = Flask(__name__)
  app.wsgi_app = ApitallyMiddleware(
      app,
      client_id="your-client-id",
      env="dev",
      # other parameters ...
  )
  ```
</CodeGroup>

See the [setup guides](/setup-guides#python) for more examples.

## Parameters

The following configuration parameters are available.
Only `client_id` and `env` are required.

| Parameter | Description | Type | Default |
| :-------- | :---------- | :--- | :------ |
| `client_id` | Client ID for your application. Find it on the _Setup instructions_ page for your app. | `string` |
| `env` | Name of the environment, e.g. `prod` or `dev`. The environment will be automatically created if it doesn't exist. | `string` | `dev` |
| `app_version` | The current version of your application, e.g. `1.0.0`. | `string` | `None` |
| `enable_request_logging` | Whether request logging is enabled. | `bool` | `False` |
| `log_query_params` | Whether to include query parameters in the logs. If disabled, these will be stripped from the request URLs logged. | `bool` | `True` |
| `log_request_headers` | Whether to include request headers in the logs. Default masking for common sensitive headers (e.g. `Authorization`) applies. | `bool` | `False` |
| `log_request_body` | Whether to include the request body in the logs. Only JSON and text are supported, up to 50 KB. | `bool` | `False` |
| `log_response_headers` | Whether to include response headers in the logs. | `bool` | `True` |
| `log_response_body` | Whether to include the response body in the logs. Only JSON and text are supported, up to 50 KB. | `bool` | `False` |
| `log_exception` | Whether to include exception details in the logs. | `bool` | `True` |
| `capture_logs` | Whether to capture application logs emitted during request handling. | `bool` | `False` |
| `capture_traces` | Whether to enable tracing with OpenTelemetry. | `bool` | `False` |
| `mask_query_params` | List of regular expressions for matching query parameters to mask. These are in addition to the default masking patterns. | `list[str]` | `[]` |
| `mask_headers` | List of regular expressions for matching headers to mask. These are in addition to the default masking patterns. | `list[str]` | `[]` |
| `mask_body_fields` | List of regular expressions for matching request/response body fields to mask. These are in addition to the default masking patterns. | `list[str]` | `[]` |
| `mask_request_body_callback` | Callback function for masking the request body. Takes one parameter `request` and returns the request body as `bytes` or `None`. | `Callable` | `None` |
| `mask_response_body_callback` | Callback function for masking the response body. Takes two parameters `request` and `response` and returns the response body as `bytes` or `None`. | `Callable` | `None` |
| `exclude_paths` | List of regular expressions for matching paths to exclude from logging. | `list[str]` | `[]` |
| `exclude_callback` | Callback function for excluding requests from logging. Takes two parameters `request` and `response` and returns `True`, if the request should be excluded, or `False` otherwise. | `Callable` | `None` |

## Callback arguments

The `mask_request_body_callback`, `mask_response_body_callback` and `exclude_callback` parameters accept a callback function that takes a `request` object as the first argument. This is a `dict` with the following keys:

| Key | Description | Type |
| :-- | :---------- | :--- |
| `timestamp` | Unix timestamp of the request. | `float` |
| `method` | HTTP method of the request. | `str` |
| `path` | Path of the request. | `str` |
| `url` | Full URL of the request. | `str` |
| `headers` | Array of key-value pairs representing the request headers. | `list[tuple[str, str]]` |
| `size` | Size of the request body in bytes. | `int` |
| `consumer` | Identifier of the consumer making the request. | `str` |
| `body` | Raw request body. | `bytes` |

The `mask_response_body_callback` and `exclude_callback` callback functions also take a `response` object as the second argument. This is a `dict` with the following keys:

| Key | Description | Type |
| :-- | :---------- | :--- |
| `status_code` | HTTP status code of the response. | `int` |
| `response_time` | Time taken to respond to the request in seconds. | `float` |
| `headers` | Array of key-value pairs representing the response headers. | `list[tuple[str, str]]` |
| `size` | Size of the response body in bytes. | `int` |
| `body` | Raw response body. | `bytes` |
